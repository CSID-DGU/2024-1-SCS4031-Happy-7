<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Trade Bitcoin</title>
</head>
<body>
    <h2>Trade Bitcoin</h2>

    <form th:action="@{/buy}" method="post">
        <div>
            <label for="price">Price to Buy (KRW):</label>
            <input type="text" id="price" name="price" placeholder="Enter price in KRW" required />
        </div>
        <button type="submit" name="action" value="buy">Buy Bitcoin</button>
    </form>


    <form th:action="@{/sell}" method="post">
        <div>
            <label for="price">Volume to Sell (BTC):</label>
            <input type="text" id="volume" name="volume" placeholder="Enter Bitcoin volume to sell" required />
        </div>
        <button type="submit" name="action" value="sell">Sell Bitcoin</button>
    </form>

    <form th:action="@{/scheduleBuy}" method="post">
        <div>
            <label for="buyPrice">Amount to Buy (KRW):</label>
            <input type="text" id="buyPrice" name="price" placeholder="Enter price in KRW" required />
        </div>
        <div>
            <label for="buyTime">Target Time (hh:mm:ss):</label>
            <input type="text" id="buyTime" name="targetTime" placeholder="e.g., 15:30:00" required />
        </div>
        <button type="submit">Schedule Buy Order</button>
    </form>
    <form th:action="@{/scheduleSell}" method="post">
        <div>
            <label for="sellVolume">Volume to Sell (BTC):</label>
            <input type="text" id="sellVolume" name="volume" placeholder="Enter Bitcoin volume to sell" required />
        </div>
        <div>
            <label for="sellTime">Target Time (hh:mm:ss):</label>
            <input type="text" id="sellTime" name="targetTime" placeholder="e.g., 15:30:00" required />
        </div>
        <button type="submit">Schedule Sell Order</button>
    </form>
    <form th:action="@{/scheduleOrder}" method="post">
        <div>
            <label for="orderType">Order Type:</label>
            <select id="orderType" name="action" required>
                <option value="buy">Buy</option>
                <option value="sell">Sell</option>
            </select>
        </div>
        <div>
            <label for="orderAmount">Amount (KRW for Buy / BTC for Sell):</label>
            <input type="text" id="orderAmount" name="amount" placeholder="Enter amount" required />
        </div>
        <div>
            <label for="targetTime">Target Time (hh:mm:ss):</label>
            <input type="text" id="targetTime" name="targetTime" placeholder="e.g., 15:30:00" required />
        </div>
        <button type="submit">Schedule Order</button>
    </form>

    <p th:if="${errorMessage}" style="color:red;">[[${errorMessage}]]</p>
    <p th:if="${successMessage}" style="color:green;">[[${successMessage}]]</p>

    <h3>Scheduled Orders</h3>
<table>
    <thead>
        <tr>
            <th>Time</th>
            <th>Action</th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="entry : ${scheduledOrders}">
            <td th:text="${entry.key}"></td>
            <td th:text="${entry.value.action}"></td>
            <td th:text="${entry.value.amount}"></td>
        </tr>
    </tbody>
</table>

<button id="reloadButton" type="button">Reload Scheduled Orders</button>
<script>
    document.getElementById("reloadButton").addEventListener("click", function () {
        fetch('/reloadScheduledOrders')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector("#scheduledOrdersTable tbody");
                tableBody.innerHTML = ""; // Clear the current table rows

                for (const [time, order] of Object.entries(data)) {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${time}</td>
                        <td>${order.action}</td>
                        <td>${order.amount}</td>
                    `;
                    tableBody.appendChild(row);
                }
            })
            .catch(error => console.error("Error reloading scheduled orders:", error));
    });
</script>

    <div>
        <a href="/home"><button type="button">Back to Home</button></a>
    </div>
</body>
</html>
